<!-- 评论管理 -->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>博客后台管理</title>
	
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="../assets/materialize/css/materialize.min.css" media="screen,projection" />
    <!-- Bootstrap Styles-->
    <link href="../assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FontAwesome Styles-->
    <link href="../assets/css/font-awesome.css" rel="stylesheet" />
    <!-- Morris Chart Styles-->
    <link href="../assets/js/morris/morris-0.4.3.min.css" rel="stylesheet" />
    <!-- Custom Styles-->
    <link href="../assets/css/custom-styles.css" rel="stylesheet" />
    <!-- Google Fonts-->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
    <link rel="stylesheet" href="../assets/js/Lightweight-Chart/cssCharts.css"> 
</head>
<style type="text/css">
    a{
        cursor: pointer;
    }
</style>
<body>
    <div id="wrapper">
        <nav class="navbar navbar-default top-navbar" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle waves-effect waves-dark" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand waves-effect waves-dark" href="index.html"><i class="large material-icons">insert_chart</i> <strong>后台管理</strong></a>
				
		<div id="sideNav" href=""><i class="material-icons dp48">toc</i></div>
            </div>

            <ul class="nav navbar-top-links navbar-right"> 
				  <li><a class="dropdown-button waves-effect waves-dark" href="#!" data-activates="dropdown1"><i class="fa fa-user fa-fw"></i> <b id="username"></b> <i class="material-icons right">arrow_drop_down</i></a></li>
            </ul>
        </nav>
		<!-- Dropdown Structure -->
<ul id="dropdown1" class="dropdown-content">
<li><a href="personalInfo.html"><i class="fa fa-user fa-fw"></i>个人信息</a>
</li>
<li><a href="setting.html"><i class="fa fa-gear fa-fw"></i> 设置</a>
</li> 
<li><a href="/logout"><i class="fa fa-sign-out fa-fw"></i> 注销</a>
</li>
</ul>


	   <!--/. NAV TOP  -->
        <nav class="navbar-default navbar-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">

                    <li>
                        <a href="index.html"><i class="fa fa-dashboard"></i>数据统计</a>
                    </li>
                    <li>
                        <a href="articleMgr.html" class="waves-effect waves-dark"><i class="fa fa-desktop"></i>文章管理</a>
                    </li>
					<li>
                        <a class="active-menu waves-effect waves-dark" href="commentMgr.html" class="waves-effect waves-dark"><i class="fa fa-bar-chart-o"></i> 评论管理</a>
                    </li>
                </ul>

            </div>

        </nav>
        <!-- /. NAV SIDE  -->
      
		<div id="page-wrapper">
		  <div class="header"> 
                        <h1 class="page-header">
                            评论管理
                        </h1>
						<ol class="breadcrumb">
					  <li><a href="#">后台</a></li>
					  <li><a href="#">评论管理</a></li>
					  <li class="active">数据</li>
					</ol> 
									
		</div>
            <div id="page-inner">

			
                <div class="row" id="review_content" >
                   <!-- <div class="col-md-12 col-sm-12">
                         <div class="card teal">
                            <div class="card-content white-text">
                              <span class="card-title">罗小虫</span>
                              <p>hh，什么辣鸡博客</p>
                              <p align="right">——成龙 回复：李才辣鸡</p>
                              <div class="card-action" align="right">
                                <a href="#" class="activator">回复</a>
                                <a href="#">删除</a>
                              </div>
                            </div>
                            <div class="card-reveal">
                              <span class="card-title grey-text text-darken-4">回复内容<i class="material-icons right">close</i></span>
                              <input type="text">
                              <button class="btn btn-success">提交</button>
                            </div>
                          </div>
                    </div> -->
                </div>
			

			   <div class="fixed-action-btn horizontal click-to-toggle">
    <a class="btn-floating btn-large red">
      <i class="material-icons">menu</i>
    </a>
    <ul>
      <li><a class="btn-floating red" title="写博客" href="write.html"><i class="material-icons">mode_edit</i></a></li>
      <li><a class="btn-floating green" id="re_top" title="返回顶部"><i class="material-icons">publish</i></a></li>
      <li><a class="btn-floating yellow" title="修改密码" href="updatePwd.html"><i class="material-icons">lock_outline</i></a></li>
      <li><a class="btn-floating blue" title="注销" href="/logout"><i class="material-icons">power_settings_new</i></a></li>
    </ul>
  </div>
            </div>
            <!-- /. PAGE INNER  -->
        </div>
        <!-- /. PAGE WRAPPER  -->
    </div>
    <!-- /. WRAPPER  -->
    <!-- JS Scripts-->
    <!-- jQuery Js -->
    <script src="../assets/js/jquery-1.10.2.js"></script>
	<script src="../resources/js/admin_root.js"></script>
	<!-- Bootstrap Js -->
    <script src="../assets/js/bootstrap.min.js"></script>
	
	<script src="../assets/materialize/js/materialize.min.js"></script>
	
    <!-- Metis Menu Js -->
    <script src="../assets/js/jquery.metisMenu.js"></script>
    <!-- Morris Chart Js -->
    <script src="../assets/js/morris/raphael-2.1.0.min.js"></script>
    <script src="../assets/js/morris/morris.js"></script>
	
	
	<script src="../assets/js/easypiechart.js"></script>
	<script src="../assets/js/easypiechart-data.js"></script>
	
	 <script src="../assets/js/Lightweight-Chart/jquery.chart.js"></script>
	
    <!-- Custom Js -->
    <script src="../assets/js/custom-scripts.js"></script> 
 

</body>
<script type="text/javascript">
var article_id = getUrlParameter('id');
$(function(){
    var url = "/reviews/all";//显示全部评论的url
    //若文章id不为空，则加载文章的
    if(article_id != ''){
        url = '/reviews/reviewList';
        review_list(url);
    }else{
        review_list(url);
    }
  
});
//回复评论
function review_reply(id,art_id){
    var url = '/reviews/sendReviews';
    var review = $('#reply_input'+id).val();
    var name = $('#username').text();
    $.ajax({
        url: url,
        type:'POST',
        data:{
            articleId:art_id,
            parentId:id,
            name:name,
            url:'',
            level:'2',
            email:'',
            reviewCount:review,
        },
        success: function (data) {
            alert("回复成功");
            myrefresh();
            // $('#review_content').html(html);
        }
    })
}
//删除评论
function review_delete(id){
    var url = "/reviews/delete";
    var r=confirm("确认删除吗？");
    if (r==true){
        $.ajax({
            url: url,
            type:'POST',
            data:{
                reviewId:id,
            },
            success: function (data) {
                alert("删除成功");
                myrefresh();
            }
        })
    }
    
}
//拼接评论列表
function review_list(url){
    var html = "";
    
    $.ajax({
        url: url,
        type:'POST',
        data:{
            articleId:article_id,
        },success: function (data) {
            // url = "";  //显示当前文章下评论的url
            // review_list(url);
            var reviews;
            // if(article_id != ''){
            //     reviews = data.data.reviews;
            // }else{
                reviews = data.data;
            // }
            var reply = "";
            var html = '';
            var html1 = '';
            var reviewList = [];
            var second = [];
            for ( var i = 0; i < reviews.length; i++) {
                console.log("-------======------");
                if(reviews[i].parentReview == null){
                    reviewList.push(reviews[i]);
                }else{
                    second.push(reviews[i]);
                }
            }
            console.log(reviewList);
            for (var i = 0; i <= reviewList.length - 1; i++) {
                html = '<div class="col-md-12 col-sm-12"><div class="card teal"><div class="card-content white-text"><span class="card-title">'+reviewList[i].name+'</span><p>'+reviewList[i].content+'</p><p align="right" id="reply'+reviewList[i].id+'"></p><div class="card-action" align="right"><a class="activator">回复</a><a onclick="review_delete(\''+reviewList[i].id+'\')">删除</a></div></div><div class="card-reveal"><span class="card-title grey-text text-darken-4">回复内容<i class="material-icons right">close</i></span><input type="text" id="reply_input'+reviewList[i].id+'"><button class="btn btn-success" onclick="review_reply(\''+reviewList[i].id+'\',\''+reviewList[i].article.id+'\')">提交</button></div></div></div>';
                html1 = '';
                for (var j = 0; j <= second.length - 1; j++) {
                    if (second[j].parentReview.floor == reviewList[i].floor) {
                        html1 = html1 + '——'+second[j].name+' 回复 '+reviewList[i].name+'：'+second[j].content + '&nbsp;<a style="color:#FFA96A" onclick="review_delete(\''+second[j].id+'\')">删除</a><br>';
                    }
                }
                $('#review_content').append(html);
                $('#reply'+reviewList[i].id).html(html1);
            }
            
            // for (var i = 0; i <= reviews.length - 1; i++) {
                
            //     if (reviews[i].level == 2) {
            //         if (reviews[i].parentReview != '') {
            //             reply = '——'+reviews[i].name+' 回复 '+reviews[i].parentReview.name+'：'+reviews[i].content;
            //             $('#reply'+reviews[i].parentReview.id).text(reply);
            //             $('#reply_input'+reviews[i].parentReview.id).val(reviews[i].content);
            //         }
            //     } 
            // }
            
        },
    });
}
</script>
</html>